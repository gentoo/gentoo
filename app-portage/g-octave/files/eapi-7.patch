diff -ur g-octave-0.4.1/g_octave/ebuild.py g-octave-0.4.1.1/g_octave/ebuild.py
--- g-octave-0.4.1/g_octave/ebuild.py	2010-10-23 17:37:26.000000000 -0400
+++ g-octave-0.4.1.1/g_octave/ebuild.py	2022-10-13 21:26:10.025290287 -0400
@@ -127,11 +127,11 @@
 # Distributed under the terms of the GNU General Public License v2
 # This ebuild was generated by g-octave
 
-EAPI="3"
+EAPI=7
 
 G_OCTAVE_CAT="%(category)s"
 
-inherit g-octave%(eutils)s
+inherit g-octave
 
 DESCRIPTION="%(description)s"
 HOMEPAGE="%(url)s"
@@ -169,7 +169,6 @@
         category = self.__dbtree.categories.get(self.pkgname, '')
         
         vars = {
-            'eutils': '',
             'description': description,
             'url': self.__desc.url,
             'license': self.__desc.license_gentoo,
@@ -200,11 +199,10 @@
             
             patch_string = ''
             for patch in patches:
-                patch_string += "\n\tepatch \"${FILESDIR}/%s\"" % patch
+                patch_string += "\n\t\"${FILESDIR}/%s\"" % patch
                 shutil.copy2(os.path.join(patchesdir, patch), filesdir)
             
-            ebuild += "\nsrc_prepare() {%s\n\tg-octave_src_prepare\n}\n" % patch_string
-            vars['eutils'] = ' eutils'
+            ebuild += "\nPATCHES=(%s\n)\n" % patch_string
             
         with open(ebuild_file, 'w') as fp:
             fp.write(ebuild % vars)
diff -ur g-octave-0.4.1/share/g-octave.eclass g-octave-0.4.1.1/share/g-octave.eclass
--- g-octave-0.4.1/share/g-octave.eclass	2022-10-13 21:19:25.017252939 -0400
+++ g-octave-0.4.1.1/share/g-octave.eclass	2022-10-13 21:25:28.383286447 -0400
@@ -15,10 +15,10 @@
 
 REPO_URI="http://svn.code.sf.net/p/octave/code/trunk/octave-forge"
 if [[ ${PV} = 9999* ]]; then
-	inherit subversion autotools
+	inherit subversion autotools flag-o-matic
 	ESVN_REPO_URI="${REPO_URI}/${G_OCTAVE_CAT}/${PN}"
 else
-	inherit autotools
+	inherit autotools flag-o-matic
 	SRC_URI="mirror://sourceforge/octave/${P}.tar.gz"
 fi
 
@@ -37,19 +37,25 @@
 OCT_PKGDIR="${OCT_ROOT}/packages"
 OCT_BIN="$(type -p octave)"
 
-EXPORT_FUNCTIONS src_prepare src_install pkg_postinst pkg_prerm pkg_postrm
+EXPORT_FUNCTIONS src_unpack src_prepare src_compile src_install pkg_postinst pkg_prerm pkg_postrm
 
-g-octave_src_prepare() {
+g-octave_src_unpack() {
+	unpack "${P}.tar.gz"
 	if [ ! -d "${WORKDIR}/${P}" ]; then
 		S="${WORKDIR}/${PN}"
 		cd "${S}"
 	fi
+}
+
+g-octave_src_prepare() {
 	[[ ${PV} = 9999* ]] && subversion_src_prepare
+	default
 	for filename in Makefile configure; do
 		cp "${DISTDIR}/g-octave_${filename}" "${S}/${filename}"
 	done
 
 	sed -i -e 's@libexec@lib@g' "${S}/Makefile" || die 'sed failed.'
+	sed -i -e 's@octave_config_info@__octave_config_info__@g' "${S}/Makefile" || die 'sed failed.'
 
 	chmod 0755 "${S}/configure"
 	if [ -e "${S}"/src/autogen.sh ]; then
@@ -60,6 +66,11 @@
 	fi
 }
 
+g-octave_src_compile() {
+	append-ldflags -L$(mkoctfile -p OCTLIBDIR)
+	emake
+}
+
 g-octave_src_install() {
 	emake DESTDIR="${D}" DISTPKG='Gentoo' install
 	if [ -d doc/ ]; then
