From 76a2ab26febc38c0e113f374e4f5bed851b8d140 Mon Sep 17 00:00:00 2001
From: Ted Rodgers <ted.d.rodgers@gmail.com>
Date: Sat, 3 Jan 2026 18:44:27 -0500
Subject: [PATCH] bug 968267: move to DEFAULT_SOURCE from BSD_SOURCE in
 rc/Makefile.am + src/Makefile..in; bug 968267 + bug 884823: gdrom/gdrom.c
 include arpa/inet.h ; bug 740384: remove calls to / use of subversion

---
 src/Makefile.am      |  5 ++---
 src/Makefile.in      |  3 +--
 src/checkver.pl      | 19 ++++---------------
 src/gdrom/gdrom.c    |  1 +
 src/gtkui/gtk_ctrl.c |  2 +-
 5 files changed, 9 insertions(+), 21 deletions(-)

diff --git a/src/Makefile.am b/src/Makefile.am
index 8691ef1..7f08297 100644
--- a/src/Makefile.am
+++ b/src/Makefile.am
@@ -1,5 +1,4 @@
 ## Process this file with automake to produce Makefile.in
-SVNVERSION=@SVNVERSION@
 INCLUDES = \
 	-DPACKAGE_DATA_DIR=\""$(datadir)"\" \
 	-DPACKAGE_LOCALE_DIR=\""$(prefix)/$(DATADIRNAME)/locale"\" \
@@ -17,7 +16,7 @@ check_PROGRAMS = test/testxlt
 
 pkglib_PROGRAMS=
 EXTRA_DIST=drivers/genkeymap.pl checkver.pl drivers/dummy.c
-AM_CFLAGS = -D__EXTENSIONS__ -D_BSD_SOURCE -D_GNU_SOURCE
+AM_CFLAGS = -D__EXTENSIONS__ -D_DEFAULT_SOURCE -D_GNU_SOURCE
 
 .PHONY: checkversion
 checkversion:
@@ -252,4 +251,4 @@ pvr2/gl_slsrc.c: genglsl pvr2/vertex.glsl pvr2/fragment.glsl
 	./genglsl $(srcdir)/pvr2/vertex.glsl $(srcdir)/pvr2/fragment.glsl $@
 drivers/mac_keymap.h: drivers/mac_keymap.txt drivers/genkeymap.pl
 	$(srcdir)/drivers/genkeymap.pl mac $(srcdir)/drivers/mac_keymap.txt > $@
-	
\ No newline at end of file
+	
diff --git a/src/Makefile.in b/src/Makefile.in
index 5c2f049..8dbfa28 100644
--- a/src/Makefile.in
+++ b/src/Makefile.in
@@ -512,7 +512,6 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 sysconfdir = @sysconfdir@
 target_alias = @target_alias@
-SVNVERSION = @SVNVERSION@
 INCLUDES = \
 	-DPACKAGE_DATA_DIR=\""$(datadir)"\" \
 	-DPACKAGE_LOCALE_DIR=\""$(prefix)/$(DATADIRNAME)/locale"\" \
@@ -522,7 +521,7 @@ INCLUDES = \
 	@GLIB_CFLAGS@ @GTK_CFLAGS@ @LIBPNG_CFLAGS@ @PULSE_CFLAGS@ @ESOUND_CFLAGS@ @ALSA_CFLAGS@ @SDL_CFLAGS@
 
 EXTRA_DIST = drivers/genkeymap.pl checkver.pl drivers/dummy.c
-AM_CFLAGS = -D__EXTENSIONS__ -D_BSD_SOURCE -D_GNU_SOURCE
+AM_CFLAGS = -D__EXTENSIONS__ -D_DEFAULT_SOURCE -D_GNU_SOURCE
 TESTS = test/testxlt
 BUILT_SOURCES = sh4/sh4core.c sh4/sh4dasm.c sh4/sh4x86.c sh4/sh4stat.c \
 	pvr2/gl_slsrc.c drivers/mac_keymap.h version.c
diff --git a/src/checkver.pl b/src/checkver.pl
index 3fbcced..b12c9af 100755
--- a/src/checkver.pl
+++ b/src/checkver.pl
@@ -1,28 +1,17 @@
 #!/usr/bin/perl
 # Usage: updatever.pl <basever> <top_srcdir> <version file>
 
-my $svnversion = "svnversion";
-my $basever = $ARGV[0];
 my $top_srcdir = $ARGV[1];
 my $outfile = $ARGV[2];
 
 my $rev = "";
 my $full_ver = "$basever";
 
-if( $svnversion ) {
-   $rev = `$svnversion "$top_srcdir"`;
-   chomp $rev;
-   if( $rev == "exported" ) {
-      $rev = "";
-   } else {
-      $full_ver = "${basever}.${rev}";
-   }
-}
 my $header = "/* Autogenerated by checkver.pl */";
 my $output = "${header}\n".
-             "const char lxdream_package_name[] = \"lxdream $basever\";\n" .
-             "const char lxdream_short_version[] = \"$basever\";\n" .
-             "const char lxdream_full_version[] = \"$full_ver\";\n" .
+             "const char lxdream_package_name[] = \"lxdream 0.9.1\";\n" .
+             "const char lxdream_short_version[] = \"0.9.1\";\n" .
+             "const char lxdream_full_version[] = \"0.9.1\";\n" .
              "const char lxdream_copyright[] = \"Copyright (C) 2005-2008 Nathan Keynes\";\n";
 
 my $oldfile = "";
@@ -36,4 +25,4 @@ if( $oldfile ne $output ) {
     open(VERSIONFILE, ">$outfile") || die "Unable to write to $outfile\n";
     print VERSIONFILE $output;
     close(VERSIONFILE);
-}
\ No newline at end of file
+}
diff --git a/src/gdrom/gdrom.c b/src/gdrom/gdrom.c
index 90756ed..35b6482 100644
--- a/src/gdrom/gdrom.c
+++ b/src/gdrom/gdrom.c
@@ -21,6 +21,7 @@
 #include <errno.h>
 #include <ctype.h>
 #include <glib.h>
+#include <arpa/inet.h>
 #include "gdrom/ide.h"
 #include "gdrom/gdrom.h"
 #include "gdrom/gddriver.h"
diff --git a/src/gtkui/gtk_ctrl.c b/src/gtkui/gtk_ctrl.c
index 93ea881..6296f49 100644
--- a/src/gtkui/gtk_ctrl.c
+++ b/src/gtkui/gtk_ctrl.c
@@ -310,7 +310,7 @@ static gboolean maple_device_changed( GtkComboBox *combo, gpointer user_data )
                         MAPLE_VMU_HAS_NAME(maple_data[i].new_device, vmu_filename) ) {
                     maple_data[i].new_device->destroy(maple_data[i].new_device);
                     maple_data[i].new_device = NULL;
-                    gtk_combo_box_set_active(maple_data[i].combo,0);
+                    gtk_combo_box_set_active(GTK_COMBO_BOX(maple_data[i].combo),0);
                 }
             }
             MAPLE_SET_VMU_NAME(data->new_device,vmu_filename);
-- 
2.52.0