From 038a65883551fdccc0bb86600309bb85d2251f98 Mon Sep 17 00:00:00 2001
From: Kaian <kaian@irontec.com>
Date: Wed, 1 Mar 2023 12:55:10 +0100
Subject: [PATCH] capture: properly validate capture length calculated from IP
 headers #430

---
 src/capture.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/src/capture.c b/src/capture.c
index 825ee126..00570638 100644
--- a/src/capture.c
+++ b/src/capture.c
@@ -616,6 +616,10 @@ capture_packet_reasm_ip(capture_info_t *capinfo, const struct pcap_pkthdr *heade
         }
     }
 
+    // Check maximum capture len
+    if (*caplen > MAX_CAPTURE_LEN)
+        return NULL;
+
     // If no fragmentation
     if (ip_frag == 0) {
         // Just create a new packet with given network data
