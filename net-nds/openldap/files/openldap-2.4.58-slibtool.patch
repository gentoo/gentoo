https://bugs.gentoo.org/777804

commit 236b3a0d91774d7032c6aaf483e8a25075f31af3
Author: orbea <orbea@riseup.net>
Date:   Wed Mar 24 21:38:55 2021 -0700

    Fix build with --disable-static and slibtool.

diff --git a/build/top.mk b/build/top.mk
index f542ded..f07ff77 100644
--- a/build/top.mk
+++ b/build/top.mk
@@ -86,6 +86,11 @@ LTONLY_yes = --tag=disable-shared
 LTONLY_mod = --tag=disable-static
 LTONLY_MOD = $(LTONLY_$(BUILD_MOD))
 
+# static flag for modules
+STATIC_yes = -static
+STATIC_mod =
+STATIC_MOD = $(STATIC_$(BUILD_MOD))
+
 # platform-specific libtool flags
 NT_LTFLAGS_LIB = -no-undefined -avoid-version -rpath $(libdir)
 NT_LTFLAGS_MOD = -no-undefined -avoid-version -rpath $(moduledir)
@@ -116,7 +121,7 @@ LTLINK_LIB = $(LIBTOOL) $(LTONLY_LIB) --mode=link \
 	$(CC) $(LT_CFLAGS) $(LDFLAGS) $(LTFLAGS_LIB)
 
 LTCOMPILE_MOD = $(LIBTOOL) $(LTONLY_MOD) --mode=compile \
-	$(CC) $(LT_CFLAGS) $(LT_CPPFLAGS) $(MOD_DEFS) -c
+	$(CC) $(STATIC_MOD) $(LT_CFLAGS) $(LT_CPPFLAGS) $(MOD_DEFS) -c
 
 LTLINK_MOD = $(LIBTOOL) $(LTONLY_MOD) --mode=link \
 	$(CC) $(LT_CFLAGS) $(LDFLAGS) $(LTFLAGS_MOD)
