From 3d330dc50a608581c81d269b661af0c938155428 Mon Sep 17 00:00:00 2001
From: Paul Zander <negril.nx+gentoo@gmail.com>
Date: Fri, 26 Jul 2024 00:10:33 +0200
Subject: [PATCH 1/5] main must return int

Signed-off-by: Paul Zander <negril.nx+gentoo@gmail.com>
---
 CONFIG/src/backend/archinfo_aix.c     |  2 +-
 CONFIG/src/backend/archinfo_freebsd.c |  2 +-
 CONFIG/src/backend/archinfo_irix.c    |  2 +-
 CONFIG/src/backend/archinfo_linux.c   |  2 +-
 CONFIG/src/backend/archinfo_sfu.c     |  2 +-
 CONFIG/src/backend/archinfo_sunos.c   |  2 +-
 CONFIG/src/backend/archinfo_win.c     |  2 +-
 CONFIG/src/backend/archinfo_x86.c     |  2 +-
 bin/extract.c                         |  2 +-
 bin/gpmmtst.c                         | 10 +++++-----
 bin/invtst.c                          |  2 +-
 bin/llttst.c                          |  2 +-
 bin/lutst.c                           |  2 +-
 bin/slvtst.c                          |  2 +-
 bin/uumtst.c                          |  2 +-
 lib/qr.c                              |  2 +-
 lib/test_dynlink.c                    |  2 +-
 tune/sysinfo/masrch.c                 |  2 +-
 18 files changed, 22 insertions(+), 22 deletions(-)

diff --git a/CONFIG/src/backend/archinfo_aix.c b/CONFIG/src/backend/archinfo_aix.c
index 8365c88..c5976a0 100644
--- a/CONFIG/src/backend/archinfo_aix.c
+++ b/CONFIG/src/backend/archinfo_aix.c
@@ -180,7 +180,7 @@ int ProbeThrottle()
    return(iret);
 }
 
-main(int nargs, char **args)
+int main(int nargs, char **args)
 {
    int flags, CacheLevel, ncpu, mhz, bits, sure;
    enum MACHTYPE arch=MACHOther;
diff --git a/CONFIG/src/backend/archinfo_freebsd.c b/CONFIG/src/backend/archinfo_freebsd.c
index 8d1323f..113d4c2 100644
--- a/CONFIG/src/backend/archinfo_freebsd.c
+++ b/CONFIG/src/backend/archinfo_freebsd.c
@@ -243,7 +243,7 @@ int ProbeThrottle()
    return(iret);
 }
 
-main(int nargs, char **args)
+int main(int nargs, char **args)
 {
    int flags, CacheLevel, ncpu, mhz, bits, sure;
    enum MACHTYPE arch=MACHOther;
diff --git a/CONFIG/src/backend/archinfo_irix.c b/CONFIG/src/backend/archinfo_irix.c
index 69572ec..f3f492e 100644
--- a/CONFIG/src/backend/archinfo_irix.c
+++ b/CONFIG/src/backend/archinfo_irix.c
@@ -198,7 +198,7 @@ int ProbeThrottle()
    return(iret);
 }
 
-main(int nargs, char **args)
+int main(int nargs, char **args)
 {
    int flags, CacheLevel, ncpu, mhz, bits, sure;
    enum MACHTYPE arch=MACHOther;
diff --git a/CONFIG/src/backend/archinfo_linux.c b/CONFIG/src/backend/archinfo_linux.c
index cdcee92..f07b135 100644
--- a/CONFIG/src/backend/archinfo_linux.c
+++ b/CONFIG/src/backend/archinfo_linux.c
@@ -571,7 +571,7 @@ int ProbeThrottle()
    return(iret);
 }
 
-main(int nargs, char **args)
+int main(int nargs, char **args)
 {
    int flags, CacheLevel, ncpu, mhz, bits, sure;
    enum MACHTYPE arch=MACHOther;
diff --git a/CONFIG/src/backend/archinfo_sfu.c b/CONFIG/src/backend/archinfo_sfu.c
index b3aaae9..79da486 100644
--- a/CONFIG/src/backend/archinfo_sfu.c
+++ b/CONFIG/src/backend/archinfo_sfu.c
@@ -151,7 +151,7 @@ int ProbeThrottle()
    return(iret);
 }
 
-main(int nargs, char **args)
+int main(int nargs, char **args)
 {
    int flags, CacheLevel, ncpu, mhz, bits, sure;
    enum MACHTYPE arch=MACHOther;
diff --git a/CONFIG/src/backend/archinfo_sunos.c b/CONFIG/src/backend/archinfo_sunos.c
index 8fbcd58..30d5df4 100644
--- a/CONFIG/src/backend/archinfo_sunos.c
+++ b/CONFIG/src/backend/archinfo_sunos.c
@@ -212,7 +212,7 @@ int ProbeThrottle()
    return(iret);
 }
 
-main(int nargs, char **args)
+int main(int nargs, char **args)
 {
    int flags, CacheLevel, ncpu, mhz, bits, sure;
    enum MACHTYPE arch=MACHOther;
diff --git a/CONFIG/src/backend/archinfo_win.c b/CONFIG/src/backend/archinfo_win.c
index 7a142e8..68e5b9d 100644
--- a/CONFIG/src/backend/archinfo_win.c
+++ b/CONFIG/src/backend/archinfo_win.c
@@ -221,7 +221,7 @@ int ProbeThrottle()
    return(iret);
 }
 
-main(int nargs, char **args)
+int main(int nargs, char **args)
 {
    int flags, CacheLevel, ncpu, mhz, bits, sure;
    enum MACHTYPE arch=MACHOther;
diff --git a/CONFIG/src/backend/archinfo_x86.c b/CONFIG/src/backend/archinfo_x86.c
index f894632..a5d32cb 100644
--- a/CONFIG/src/backend/archinfo_x86.c
+++ b/CONFIG/src/backend/archinfo_x86.c
@@ -460,7 +460,7 @@ int GetFlags(int nargs, char **args, int *CacheLevel)
    return(flag);
 }
 
-main(int nargs, char **args)
+int main(int nargs, char **args)
 {
    int ierr, x86_64, flags, CacheLevel;
    unsigned family, model;
diff --git a/bin/extract.c b/bin/extract.c
index cbdad8f..a130408 100644
--- a/bin/extract.c
+++ b/bin/extract.c
@@ -3904,7 +3904,7 @@ void HandleLine(EXTENV *EE, char *line)
 }
 
 
-main(int nargs, char *args[])
+int main(int nargs, char *args[])
 {
    char line[LNLEN], *path;
    int i;
diff --git a/bin/gpmmtst.c b/bin/gpmmtst.c
index f237cf5..02e7c2d 100644
--- a/bin/gpmmtst.c
+++ b/bin/gpmmtst.c
@@ -783,11 +783,11 @@ void GetFlags(int nargs, char *args[], int *TEST,
       #endif
    }
 }
-___main(){}
-__main(){}
-MAIN__(){}
-_MAIN_(){}
-main(int nargs, char *args[])
+int ___main(){}
+int __main(){}
+int MAIN__(){}
+int _MAIN_(){}
+int main(int nargs, char *args[])
 /*
  *  tst <tst> <# TA> <TA's> <# TB's> <TB's> <M0> <MN> <incM> <N0> <NN> <incN>
  *      <K0> <KN> <incK> <# alphas> <alphas> <# betas> <betas>
diff --git a/bin/invtst.c b/bin/invtst.c
index 60a6535..7281b3a 100644
--- a/bin/invtst.c
+++ b/bin/invtst.c
@@ -743,7 +743,7 @@ void GetFlags(int nargs, char **args, int *MFLOP, int *CacheSize, TYPE *thresh,
    }
 }
 
-main(int nargs, char **args)
+int main(int nargs, char **args)
 {
    int MFLOP, CacheSize, ldagap, nord, nuplo, N0, NN, incN;
    enum TEST_UPLO *Uplo;
diff --git a/bin/llttst.c b/bin/llttst.c
index 7b638db..3dae6fb 100644
--- a/bin/llttst.c
+++ b/bin/llttst.c
@@ -538,7 +538,7 @@ void GetFlags(int nargs, char **args, int *MFLOP, int *CacheSize, TYPE *thresh,
    }
 }
 
-main(int nargs, char **args)
+int main(int nargs, char **args)
 {
    int MFLOP, CacheSize, ldagap, nuplo, N0, NN, incN;
    TYPE thresh;
diff --git a/bin/lutst.c b/bin/lutst.c
index 90b6ebb..6f832af 100644
--- a/bin/lutst.c
+++ b/bin/lutst.c
@@ -476,7 +476,7 @@ void GetFlags(int nargs, char **args, int *MFLOP, int *CacheSize, TYPE *thresh,
    if (*M0 == -1) *M0 = *MN = *incM = *MisN = 1;
 }
 
-main(int nargs, char **args)
+int main(int nargs, char **args)
 {
    int MFLOP, CacheSize, LdaIsM, MisN, NisM, M0, MN, incM, N0, NN, incN;
    int norders;
diff --git a/bin/slvtst.c b/bin/slvtst.c
index abefd31..a0ff1ee 100644
--- a/bin/slvtst.c
+++ b/bin/slvtst.c
@@ -743,7 +743,7 @@ static int DoAllTests(int nrep, int N0, int NN, int incN, int R0, int RN,
    else fprintf(stdout, "\n%d TESTS RUN, %d FAILED!!\n\n", i, ierr);
    return(ierr);
 }
-main(int nargs, char **args)
+int main(int nargs, char **args)
 {
    int ierr, N0, NN, incN, R0, RN, incR, ldagap, ldbgap, nord, nuplo;
    int CS, MFLOP, QR, nrep;
diff --git a/bin/uumtst.c b/bin/uumtst.c
index 2a914df..df51174 100644
--- a/bin/uumtst.c
+++ b/bin/uumtst.c
@@ -566,7 +566,7 @@ void GetFlags(int nargs, char **args, int *MFLOP, int *CacheSize, TYPE *thresh,
    }
 }
 
-main(int nargs, char **args)
+int main(int nargs, char **args)
 {
    int MFLOP, CacheSize, ldagap, nuplo, N0, NN, incN;
    TYPE thresh;
diff --git a/lib/qr.c b/lib/qr.c
index ffb3ac4..d4e9dc5 100644
--- a/lib/qr.c
+++ b/lib/qr.c
@@ -5,7 +5,7 @@
 #elif defined(UpCase)
    #define dgeqrf_ DGEQRF
 #endif
-main(int nargs, char **args)
+int main(int nargs, char **args)
 {
    extern void dgeqrf_(F77_INTEGER*,F77_INTEGER*,double*,F77_INTEGER*,
                        double*,double*,F77_INTEGER*,F77_INTEGER*);
diff --git a/lib/test_dynlink.c b/lib/test_dynlink.c
index e4e3570..d000da9 100644
--- a/lib/test_dynlink.c
+++ b/lib/test_dynlink.c
@@ -1,6 +1,6 @@
 #include <cblas.h>
 #include <clapack.h>
-main(int nargs, char **args)
+int main(int nargs, char **args)
 {
    double A[1]={1.0}, b[1]={1.0};
    int ipiv[1];
diff --git a/tune/sysinfo/masrch.c b/tune/sysinfo/masrch.c
index 3ad2b73..d8b7df8 100644
--- a/tune/sysinfo/masrch.c
+++ b/tune/sysinfo/masrch.c
@@ -169,7 +169,7 @@ int FindMflop
    return(mf);
 }
 
-FindNreg
+int FindNreg
 (
    char pre,   /* precision: s,d,q */
    int fmf,    /* number of mflops to force timer on */
-- 
2.45.2


From 537f1afe821d5bad24fe401c8cb1294f2235f5b7 Mon Sep 17 00:00:00 2001
From: Paul Zander <negril.nx+gentoo@gmail.com>
Date: Fri, 26 Jul 2024 00:11:42 +0200
Subject: [PATCH 2/5] add missing function declarations

Signed-off-by: Paul Zander <negril.nx+gentoo@gmail.com>
---
 CONFIG/include/atlconf_misc.h | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/CONFIG/include/atlconf_misc.h b/CONFIG/include/atlconf_misc.h
index b13ccc0..63b8fd6 100644
--- a/CONFIG/include/atlconf_misc.h
+++ b/CONFIG/include/atlconf_misc.h
@@ -41,6 +41,8 @@ char *NameWithoutPath(char *file);
 char *GetPathWithoutName(char *file);
 void GetGccVers(char *gcc, int *comp, int *major, int *minor, int *patch);
 int CompIsGcc(char *comp);
+int CompIsClang(char *comp);
+int CompIsMinGW(char *comp);
 int CompIsAppleGcc(char *comp);
 int CompIsMIPSpro(char *comp);
 int CompIsPathScale(char *comp);
-- 
2.45.2


From 975b10d484ec2c18fcc3eccbdf30fd166f2072c3 Mon Sep 17 00:00:00 2001
From: Paul Zander <negril.nx+gentoo@gmail.com>
Date: Fri, 26 Jul 2024 00:11:49 +0200
Subject: [PATCH 3/5] fix typo osnam -> osname

Signed-off-by: Paul Zander <negril.nx+gentoo@gmail.com>
---
 CONFIG/src/probe_arch.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/CONFIG/src/probe_arch.c b/CONFIG/src/probe_arch.c
index 0ab92c8..cc8b136 100644
--- a/CONFIG/src/probe_arch.c
+++ b/CONFIG/src/probe_arch.c
@@ -198,7 +198,7 @@ int ConfirmPtrbits(enum OSTYPE OS0, enum ASMDIA asmd0, char *targ0,
 /*
  * Try OS-specific probe, compiling with -m64 (assumes gcc workalike)
  */
-   i = 1 + strlen(frm) + strlen(osnam) + strlen(osnam[OS]) +
+   i = 1 + strlen(frm) + strlen(osname) + strlen(osnam[OS]) +
        strlen(ASMNAM[asmd]) + strlen(flag) + strlen(targ) + strlen(find);
    cmnd = malloc(i*sizeof(char));
    assert(cmnd);
-- 
2.45.2


From 550c8ff309c6896635bc86001af6dbecbf043d51 Mon Sep 17 00:00:00 2001
From: Paul Zander <negril.nx+gentoo@gmail.com>
Date: Fri, 26 Jul 2024 00:15:08 +0200
Subject: [PATCH 4/5] use long long in format string

Signed-off-by: Paul Zander <negril.nx+gentoo@gmail.com>
---
 bin/atlas_install.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/bin/atlas_install.c b/bin/atlas_install.c
index ffe10e3..b8f39cc 100644
--- a/bin/atlas_install.c
+++ b/bin/atlas_install.c
@@ -278,7 +278,7 @@ long long GetFirstLongHex(char *ln)
    {
       if (isxdigit(ln[i]))
       {
-         sscanf(ln+i, "%lx", &iret);
+         sscanf(ln+i, "%llx", &iret);
          break;
       }
    }
-- 
2.45.2


From 9a9d7f5f83ea6235ee8e40d49b93545bb3c5b7c2 Mon Sep 17 00:00:00 2001
From: Paul Zander <negril.nx+gentoo@gmail.com>
Date: Fri, 26 Jul 2024 00:16:03 +0200
Subject: [PATCH 5/5] add missing string.h include

Signed-off-by: Paul Zander <negril.nx+gentoo@gmail.com>
---
 bin/qrtst.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/bin/qrtst.c b/bin/qrtst.c
index 2983af0..9b3f7c0 100644
--- a/bin/qrtst.c
+++ b/bin/qrtst.c
@@ -41,6 +41,7 @@
 #ifndef TimeF77
    #include "clapack.h"
 #endif
+#include <string.h>
 
 #ifdef ATL_FULL_LAPACK
    #include "atlas_C2Flapack.h"
-- 
2.45.2

