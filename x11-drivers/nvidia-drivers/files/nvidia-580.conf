# NVIDIA drivers options
# See /usr/share/doc/nvidia-drivers-*/README.txt* for more information.

# nvidia-drivers and nouveau / nova cannot be used at same time.
# Comment out the following lines if you wish to allow either.
blacklist nouveau
blacklist nova_core

# Kernel Mode Setting (notably needed for fbdev and wayland).
# If in doubt, even X11 users should not touch this.
options nvidia-drm modeset=1

# If modeset=1 ^, NVIDIA will handle the console/tty display and allow
# overriding DRM devices such as simpledrm by default. May or may not
# cause issues like being unable to display/switch tty properly or
# resume from sleep with *some* setups. Try disabling by uncommenting
# if need to troubleshoot issues, and re-enable if unrelated.
#options nvidia-drm fbdev=0

# Disable use of the GSP firmware, only an option when USE=kernel-open
# is disabled (which in turn disables usage of Blackwell 50xx or newer
# GPUs). This should not be touched unless it is causing known issues.
# Notably may be needed to get Runtime D3 to work with Turing GPUs.
#options nvidia NVreg_EnableGpuFirmware=0

# Suspend options. Note that Allocations=1 requires suspend hooks currently
# only used when either systemd or elogind is used to suspend. If using
# neither or have issues, try Allocations=0 (revert if it does not help
# as =0 is not recommended).
options nvidia \
	NVreg_PreserveVideoMemoryAllocations=1 \
	NVreg_TemporaryFilePath=/var/tmp

# !!! Security Warning !!!
# Do not change the DeviceFile options unless you know what you are doing.
# Only add trusted users to the 'video' group, these users may be able to
# crash, compromise, or irreparably damage the machine.
options nvidia \
	NVreg_DeviceFileGID=@VIDEOGID@ \
	NVreg_DeviceFileMode=432 \
	NVreg_DeviceFileUID=0 \
	NVreg_ModifyDeviceFiles=1

# Should be no need to touch anything below.
alias char-major-195 nvidia
alias /dev/nvidiactl char-major-195
remove nvidia modprobe -r --ignore-remove nvidia-drm nvidia-modeset nvidia-uvm nvidia
