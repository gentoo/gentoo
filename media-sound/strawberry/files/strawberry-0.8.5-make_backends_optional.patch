From c0ab9083306a3664cc277dfcde9730f473d08a54 Mon Sep 17 00:00:00 2001
From: Lars Wendler <polynomial-c@gentoo.org>
Date: Mon, 4 Jan 2021 16:55:12 +0100
Subject: [PATCH] CMakeLists.txt: Make gstreamer/vlc backend search optional

Gentoo-bug: https://bugs.gentoo.org/757780
Signed-off-by: Lars Wendler <polynomial-c@gentoo.org>
---
 CMakeLists.txt | 24 +++++++++++++++++-------
 1 file changed, 17 insertions(+), 7 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 41027633..df093d88 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -64,6 +64,12 @@ if(BUILD_WERROR)
   list(APPEND COMPILE_OPTIONS -Werror)
 endif(BUILD_WERROR)
 
+option(USE_GSTREAMER "Use Gstreamer as backend if found" ON)
+option(USE_VLC "Use VLC as backend if found" ON)
+if(NOT USE_GSTREAMER AND NOT USE_VLC)
+  message( FATAL_ERROR "You need to enable either Gstreamer or VLC backend" )
+endif()
+
 add_compile_options(${COMPILE_OPTIONS})
 
 if(${CMAKE_BUILD_TYPE} MATCHES "Release")
@@ -119,13 +125,17 @@ pkg_check_modules(GLIB REQUIRED glib-2.0)
 pkg_check_modules(GOBJECT REQUIRED gobject-2.0)
 pkg_check_modules(GIO REQUIRED gio-2.0)
 pkg_check_modules(LIBCDIO libcdio)
-pkg_check_modules(GSTREAMER gstreamer-1.0)
-pkg_check_modules(GSTREAMER_BASE gstreamer-base-1.0)
-pkg_check_modules(GSTREAMER_AUDIO gstreamer-audio-1.0)
-pkg_check_modules(GSTREAMER_APP gstreamer-app-1.0)
-pkg_check_modules(GSTREAMER_TAG gstreamer-tag-1.0)
-pkg_check_modules(GSTREAMER_PBUTILS gstreamer-pbutils-1.0)
-pkg_check_modules(LIBVLC libvlc)
+if(USE_GSTREAMER)
+  pkg_check_modules(GSTREAMER gstreamer-1.0)
+  pkg_check_modules(GSTREAMER_BASE gstreamer-base-1.0)
+  pkg_check_modules(GSTREAMER_AUDIO gstreamer-audio-1.0)
+  pkg_check_modules(GSTREAMER_APP gstreamer-app-1.0)
+  pkg_check_modules(GSTREAMER_TAG gstreamer-tag-1.0)
+  pkg_check_modules(GSTREAMER_PBUTILS gstreamer-pbutils-1.0)
+endif()
+if(USE_VLC)
+  pkg_check_modules(LIBVLC libvlc)
+endif()
 pkg_check_modules(SQLITE REQUIRED sqlite3>=3.9)
 pkg_check_modules(LIBPULSE libpulse)
 pkg_check_modules(CHROMAPRINT libchromaprint)
-- 
2.30.0

